<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Distraction-Free Writer</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style type="text/tailwindcss">
        :root {
            --editor-bg-light: #fdfdfd;
            --editor-text-light: #262626;
            --editor-accent-light: #6b7280;
            --editor-bg-dark: #121212;
            --editor-text-dark: #e0e0e0;
            --editor-accent-dark: #9ca3af;
            --nav-bg-light: #f5f5f5;
            --nav-bg-dark: #1a1a1a;
            --list-bg-light: #f0f0f0;
            --list-bg-dark: #202020;
        }
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-[var(--editor-bg-light)] text-[var(--editor-text-light)] dark:bg-[var(--editor-bg-dark)] dark:text-[var(--editor-text-dark)];
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { @apply bg-gray-300 dark:bg-gray-700 rounded-full; }
        ::-webkit-scrollbar-thumb:hover { @apply bg-gray-400 dark:bg-gray-600; }

        /* Navigation Panes Animation */
        .distraction-free-nav, .distraction-free-list {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
            height: 100%; position: absolute; top: 0; bottom: 0; z-index: 30;
        }
        
        /* Desktop: Panels are visible relative to each other */
        @media (min-width: 1024px) {
            .distraction-free-nav { width: 260px; left: 0; transform: translateX(-100%); opacity: 0; }
            .distraction-free-nav.active { transform: translateX(0); opacity: 1; }
            
            .distraction-free-list { width: 320px; left: 0; transform: translateX(-100%); opacity: 0; z-index: 20; }
            /* If nav is active, list pushes right. If list is active alone, it's at left 0 */
            .distraction-free-list.active { transform: translateX(0); opacity: 1; }
            .distraction-free-nav.active ~ .distraction-free-list.active { left: 260px; }
        }

        /* Mobile: Panels slide over */
        @media (max-width: 1023px) {
            .distraction-free-nav, .distraction-free-list { width: 85%; max-width: 320px; background: var(--nav-bg-light); box-shadow: 5px 0 25px rgba(0,0,0,0.1); transform: translateX(-100%); }
            .distraction-free-nav.active, .distraction-free-list.active { transform: translateX(0); }
            .dark .distraction-free-nav, .dark .distraction-free-list { background: var(--nav-bg-dark); }
        }

        .omnibar {
    <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-400/20 blur-[100px] mix-blend-multiply dark:bg-blue-500/10"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-400/20 blur-[100px] mix-blend-multiply dark:bg-purple-500/10"></div>
</div>

<div class="relative z-10 flex h-full w-full">
    
    <nav class="distraction-free-nav active" id="navigation-pane">
        <div class="flex flex-col justify-between h-full border-r border-gray-200 dark:border-gray-800 bg-[var(--nav-bg-light)] dark:bg-[var(--nav-bg-dark)]">
            <div class="flex flex-col gap-2 p-4">
                <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer transition-colors mb-4">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-xs font-bold shadow-lg">JD</div>
                    <div class="overflow-hidden">
                        <p class="text-sm font-semibold truncate">John's Workspace</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Free Plan</p>
                    </div>
                </div>
                <div class="space-y-1">
                    <button onclick="renderNoteList('all')" class="w-full flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 bg-black/5 dark:bg-white/10 rounded-lg font-medium transition-all text-left">
                        <span class="material-symbols-outlined text-[20px]">home</span>
                        <span class="text-sm">All Notes</span>
                        <span id="total-count" class="ml-auto text-xs font-bold text-gray-400">0</span>
                    </button>
                    <button onclick="renderNoteList('pinned')" class="w-full flex items-center gap-3 px-3 py-2 text-gray-600 dark:text-gray-400 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg font-medium transition-all text-left">
                        <span class="material-symbols-outlined text-[20px]">star</span>
                        <span class="text-sm">Favorites</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 border-t border-gray-200 dark:border-gray-800">
                <button class="w-full flex items-center gap-3 px-3 py-2 text-gray-600 dark:text-gray-400 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg font-medium transition-all" onclick="document.documentElement.classList.toggle('dark')">
                    <span class="material-symbols-outlined dark:hidden">dark_mode</span>
                    <span class="material-symbols-outlined hidden dark:block">light_mode</span>
                    <span class="text-sm">Toggle Theme</span>
                </button>
            </div>
        </div>
    </nav>

    <aside class="distraction-free-list active" id="note-list-pane">
        <div class="flex flex-col h-full border-r border-gray-200 dark:border-gray-800 bg-[var(--list-bg-light)] dark:bg-[var(--list-bg-dark)]">
            <div class="p-4 border-b border-gray-200 dark:border-gray-800/50">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold tracking-tight">All Notes</h2>
                    <button onclick="createNewNote()" class="p-1.5 text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900/30 rounded-lg transition-colors" title="Add Note">
                        <span class="material-symbols-outlined text-[24px]">add_circle</span>
                    </button>
                </div>
                <div class="relative group">
                    <span class="absolute left-3 top-2.5 text-gray-400 material-symbols-outlined text-[20px]">search</span>
                    <input id="search-input" class="w-full bg-gray-100 dark:bg-gray-800 border-none rounded-xl py-2.5 pl-10 pr-12 text-sm focus:ring-2 focus:ring-blue-500/50 transition-all placeholder-gray-500 dark:text-white" placeholder="Search..." type="text"/>
                </div>
            </div>
            <div id="notes-container" class="flex-1 overflow-y-auto p-3 space-y-2">
                </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative overflow-hidden bg-[var(--editor-bg-light)] dark:bg-[var(--editor-bg-dark)]">
        
        <header class="h-16 flex items-center justify-between px-6 border-b border-gray-100 dark:border-gray-800 backdrop-blur-sm z-20">
            <div class="flex items-center gap-2 text-sm text-[var(--editor-accent-light)] dark:text-[var(--editor-accent-dark)]">
                <button onclick="togglePane('nav')" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" title="Toggle Navigation">
                    <span class="material-symbols-outlined text-[20px]">menu</span>
                </button>
                <button onclick="togglePane('list')" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" title="Toggle List">
                    <span class="material-symbols-outlined text-[20px]">notes</span>
                </button>
                <span class="material-symbols-outlined text-[16px] mx-1 text-gray-300">chevron_right</span>
                <span id="header-title" class="font-medium truncate max-w-[200px]">Select a note</span>
                <div id="sync-status" class="ml-4 flex items-center gap-1 text-xs text-green-500 bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded-full opacity-0 transition-opacity">
                    <span class="material-symbols-outlined text-[14px]">cloud_done</span>
                    <span>Synced</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="togglePreviewMode()" class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg text-xs font-bold uppercase tracking-wider transition-colors">
                    <span class="material-symbols-outlined text-[18px]">visibility</span>
                    <span id="preview-btn-text">Preview</span>
                </button>
                <div class="h-4 w-px bg-gray-300 dark:bg-gray-700 mx-1"></div>
                <button onclick="togglePin()" id="pin-btn" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-400 transition-colors">
                    <span class="material-symbols-outlined text-[20px]">push_pin</span>
                </button>
                <button onclick="deleteCurrentNote()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-900/20 transition-colors text-gray-400" title="Delete">
                    <span class="material-symbols-outlined text-[20px]">delete</span>
                </button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto custom-scrollbar relative" id="editor-scroller">
            <div class="max-w-3xl mx-auto px-8 py-12">
                
                <textarea id="note-title" class="w-full bg-transparent border-none p-0 text-4xl font-bold text-[var(--editor-text-light)] dark:text-[var(--editor-text-dark)] placeholder-gray-300 dark:placeholder-gray-700 focus:ring-0 mb-6 leading-tight resize-none overflow-hidden" rows="1" placeholder="Untitled Note"></textarea>
                
                <div class="flex items-center flex-wrap gap-4 mb-8 text-sm">
                    <div class="flex items-center gap-2 text-[var(--editor-accent-light)] dark:text-[var(--editor-accent-dark)]">
                        <span class="material-symbols-outlined text-[18px]">calendar_today</span>
                        <span id="note-date">--</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-[18px] text-gray-400">label</span>
                        <div id="tags-container" class="flex gap-2 flex-wrap">
                            </div>
                        <input id="tag-input" class="bg-transparent border-none p-0 text-[var(--editor-accent-light)] dark:text-[var(--editor-accent-dark)] focus:ring-0 text-xs w-20 hover:text-gray-600 focus:text-gray-800 dark:focus:text-gray-200 transition-colors" placeholder="+ Add tag" type="text"/>
                    </div>
                </div>

                <textarea id="note-body" class="w-full h-[calc(100vh-300px)] bg-transparent border-none p-0 text-lg leading-relaxed text-[var(--editor-text-light)] dark:text-[var(--editor-text-dark)] placeholder-gray-300 dark:placeholder-gray-700 focus:ring-0 resize-none font-mono" placeholder="Start writing... (Markdown supported)"></textarea>
                
                <div id="note-preview" class="hidden prose prose-lg dark:prose-invert max-w-none preview-mode"></div>

                <div class="h-20"></div>
            </div>
        </div>

        <div id="toast" class="absolute bottom-6 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 opacity-0 translate-y-10 pointer-events-none">
            <div class="flex items-center gap-3 bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-4 py-3 rounded-lg shadow-2xl">
                <span class="material-symbols-outlined text-green-400 dark:text-green-600 text-[20px]">check_circle</span>
                <span class="text-sm font-medium">Note saved</span>
            </div>
        </div>
    </main>

    <div class="omnibar" id="omnibar">
        <div class="relative">
            <span class="absolute left-3 top-3.5 text-gray-400 material-symbols-outlined text-[20px]">add</span>
            <input id="omnibar-input" class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-xl py-3 pl-10 pr-4 text-base focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 shadow-2xl transition-all placeholder-gray-500 dark:text-white" placeholder="Type title and press Enter to create..." type="text"/>
        </div>
    </div>

</div>

<script>
    // --- Data Management ---
    const STORAGE_KEY = 'distraction_free_notes';
    let notes = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let activeNoteId = null;
    let isPreviewMode = false;

    // Default Seed Data (if empty)
    if (notes.length === 0) {
        notes = [{
            id: Date.now().toString(),
            title: "Note's whatsapp group idea",
            body: "Thinking about how we can leverage the **WhatsApp API** for quick note capturing.\n\n### Implementation Logic\nWe need a webhook listener. Here is a rough draft:\n\n```javascript\nconst express = require('express');\nconst app = express();\n\napp.post('/webhook', (req, res) => {\n  const { msg } = req.body;\n  saveToNotes(msg);\n});\n```",
            tags: ['ideas', 'dev'],
            date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
            pinned: true,
            updatedAt: Date.now()
        }];
        saveNotes();
    }

    // --- Core Functions ---

    function saveNotes() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
        renderNoteList();
        updateSyncStatus();
    }

    function createNewNote(title = "Untitled Note") {
        const newNote = {
            id: Date.now().toString(),
            title: title,
            body: "",
            tags: [],
            date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
            pinned: false,
            updatedAt: Date.now()
        };
        notes.unshift(newNote); // Add to top
        activeNoteId = newNote.id;
        saveNotes();
        loadNoteIntoEditor(newNote);
        
        // Auto-focus title
        setTimeout(() => document.getElementById('note-title').focus(), 100);
    }

    function deleteCurrentNote() {
        if(!activeNoteId) return;
        if(confirm('Are you sure you want to delete this note?')) {
            notes = notes.filter(n => n.id !== activeNoteId);
            activeNoteId = notes.length > 0 ? notes[0].id : null;
            saveNotes();
            if(activeNoteId) loadNoteIntoEditor(notes.find(n => n.id === activeNoteId));
            else clearEditor();
        }
    }

    function togglePin() {
        if(!activeNoteId) return;
        const note = notes.find(n => n.id === activeNoteId);
        note.pinned = !note.pinned;
        saveNotes();
        renderNoteList(); // Refresh list to show pin icon
        updatePinButtonState(note.pinned);
    }

    // --- Rendering ---

    function renderNoteList(filter = 'all') {
        const container = document.getElementById('notes-container');
        const searchVal = document.getElementById('search-input').value.toLowerCase();
        
        // Filter logic
        let filteredNotes = notes.filter(n => 
            n.title.toLowerCase().includes(searchVal) || 
            n.body.toLowerCase().includes(searchVal)
        );

        if (filter === 'pinned') {
            filteredNotes = filteredNotes.filter(n => n.pinned);
        }

        // Sort: Pinned first, then by date
        filteredNotes.sort((a, b) => {
            if (a.pinned === b.pinned) return b.updatedAt - a.updatedAt;
            return a.pinned ? -1 : 1;
        });

        document.getElementById('total-count').innerText = notes.length;

        container.innerHTML = filteredNotes.map(note => `
            <div onclick="setActiveNote('${note.id}')" class="group relative p-4 mb-2 rounded-xl border transition-all cursor-pointer ${note.id === activeNoteId ? 'bg-white dark:bg-gray-800 shadow-sm border-blue-500 border-l-4' : 'hover:bg-white dark:hover:bg-gray-800 border-transparent hover:border-gray-200 dark:hover:border-gray-700'}">
                <div class="flex justify-between items-start mb-1">
                    <h3 class="font-semibold text-gray-900 dark:text-gray-100 line-clamp-1 ${note.id === activeNoteId ? 'text-blue-600 dark:text-blue-400' : ''}">${note.title || 'Untitled'}</h3>
                    ${note.pinned ? '<span class="material-symbols-outlined text-[14px] text-blue-500">push_pin</span>' : ''}
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2 mb-3 h-10 overflow-hidden text-ellipsis">${note.body.substring(0, 100).replace(/[#*`]/g, '') || 'No content...'}</p>
                <div class="flex items-center gap-2 overflow-hidden">
                    ${note.tags.map(tag => `<span class="px-2 py-0.5 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-[10px] font-medium border border-gray-200 dark:border-gray-600 whitespace-nowrap">#${tag}</span>`).join('')}
                </div>
            </div>
        `).join('');
    }

    function setActiveNote(id) {
        activeNoteId = id;
        const note = notes.find(n => n.id === id);
        loadNoteIntoEditor(note);
        renderNoteList(); // Re-render to highlight active
    }

    function loadNoteIntoEditor(note) {
        if (!note) return clearEditor();
        
        document.getElementById('note-title').value = note.title;
        document.getElementById('note-body').value = note.body;
        document.getElementById('note-date').innerText = note.date;
        document.getElementById('header-title').innerText = note.title || 'Untitled';
        
        updateTagsUI(note.tags);
        updatePinButtonState(note.pinned);
        
        // Auto resize title
        const titleArea = document.getElementById('note-title');
        titleArea.style.height = 'auto';
        titleArea.style.height = titleArea.scrollHeight + 'px';

        // Handle preview mode if active
        if(isPreviewMode) renderMarkdownPreview();
    }

    function clearEditor() {
        document.getElementById('note-title').value = '';
        document.getElementById('note-body').value = '';
        document.getElementById('header-title').innerText = 'Select a note';
        document.getElementById('tags-container').innerHTML = '';
    }

    function updateTagsUI(tags) {
        const container = document.getElementById('tags-container');
        container.innerHTML = tags.map(tag => `
            <span onclick="removeTag('${tag}')" class="bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded-full text-xs font-medium border border-blue-200 dark:border-blue-800 flex items-center gap-1 group cursor-pointer hover:bg-red-100 dark:hover:bg-red-900/30 hover:border-red-200 transition-colors">
                ${tag}
                <span class="material-symbols-outlined text-[12px] opacity-0 group-hover:opacity-100">close</span>
            </span>
        `).join('');
    }

    function updatePinButtonState(isPinned) {
        const btn = document.getElementById('pin-btn');
        if (isPinned) {
            btn.classList.add('text-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
            btn.classList.remove('text-gray-400');
        } else {
            btn.classList.remove('text-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
            btn.classList.add('text-gray-400');
        }
    }

    // --- Event Listeners & Input Handling ---

    // Auto-save & Update Logic
    const handleInput = (e) => {
        if (!activeNoteId) createNewNote();
        
        const note = notes.find(n => n.id === activeNoteId);
        if (e.target.id === 'note-title') {
            note.title = e.target.value;
            document.getElementById('header-title').innerText = note.title;
            // Resize textarea
            e.target.style.height = 'auto';
            e.target.style.height = e.target.scrollHeight + 'px';
        } else if (e.target.id === 'note-body') {
            note.body = e.target.value;
        }
        note.updatedAt = Date.now();
        saveNotes(); // Calls renderNoteList()
    };

    document.getElementById('note-title').addEventListener('input', handleInput);
    document.getElementById('note-body').addEventListener('input', handleInput);

    // Search
    document.getElementById('search-input').addEventListener('input', () => renderNoteList());

    // Tag Input
    document.getElementById('tag-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && activeNoteId) {
            const tag = e.target.value.trim();
            if (tag) {
                const note = notes.find(n => n.id === activeNoteId);
                if (!note.tags.includes(tag)) {
                    note.tags.push(tag);
                    saveNotes();
                    updateTagsUI(note.tags);
                }
                e.target.value = '';
            }
        }
    });

    // Remove Tag Global Helper
    window.removeTag = (tag) => {
        if (!activeNoteId) return;
        const note = notes.find(n => n.id === activeNoteId);
        note.tags = note.tags.filter(t => t !== tag);
        saveNotes();
        updateTagsUI(note.tags);
    };

    // Omnibar
    document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'j') {
            e.preventDefault();
            const bar = document.getElementById('omnibar');
            bar.classList.toggle('active');
            if (bar.classList.contains('active')) document.getElementById('omnibar-input').focus();
        } else if (e.key === 'Escape') {
            document.getElementById('omnibar').classList.remove('active');
        }
    });

    document.getElementById('omnibar-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            createNewNote(e.target.value);
            e.target.value = '';
            document.getElementById('omnibar').classList.remove('active');
        }
    });

    // UI Toggles
    window.togglePane = (pane) => {
        const nav = document.getElementById('navigation-pane');
        const list = document.getElementById('note-list-pane');
        
        if (pane === 'nav') {
            nav.classList.toggle('active');
            // On mobile, close list if nav opens
            if (window.innerWidth < 1024 && nav.classList.contains('active')) list.classList.remove('active');
        } else if (pane === 'list') {
            list.classList.toggle('active');
            // On mobile, close nav if list opens
            if (window.innerWidth < 1024 && list.classList.contains('active')) nav.classList.remove('active');
        }
    };

    // Markdown Preview Toggle
    window.togglePreviewMode = () => {
        isPreviewMode = !isPreviewMode;
        const editor = document.getElementById('note-body');
        const preview = document.getElementById('note-preview');
        const btnText = document.getElementById('preview-btn-text');
        
        if (isPreviewMode) {
            renderMarkdownPreview();
            editor.classList.add('hidden');
            preview.classList.remove('hidden');
            btnText.innerText = 'Edit';
        } else {
            editor.classList.remove('hidden');
            preview.classList.add('hidden');
            btnText.innerText = 'Preview';
        }
    };

    function renderMarkdownPreview() {
        const content = document.getElementById('note-body').value;
        const preview = document.getElementById('note-preview');
        // Simple marked usage
        preview.innerHTML = marked.parse(content);
    }

    // Sync Status Animation
    function updateSyncStatus() {
        const status = document.getElementById('sync-status');
        const toast = document.getElementById('toast');
        
        status.style.opacity = '1';
        
        // Trigger Toast
        toast.style.opacity = '1';
        toast.style.transform = 'translate(-50%, 0)';
        
        setTimeout(() => {
            status.style.opacity = '0';
            toast.style.opacity = '0';
            toast.style.transform = 'translate(-50%, 10px)';
        }, 2000);
    }

    // --- Initialization ---
    // If there are notes, load the first one active, otherwise just render list
    if (notes.length > 0) setActiveNote(notes[0].id);
    else renderNoteList();

    // Dark mode check
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }

</script>
</body>
</html>